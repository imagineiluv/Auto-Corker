@using Microsoft.AspNetCore.Components
@using Corker.Core.Interfaces
@inject ISettingsService SettingsService

<div class="sidebar-header">
    <div class="app-brand">Corker</div>
    <span class="app-badge">Local-first AI engineer</span>
</div>

<div class="sidebar-section">
    <div class="sidebar-label">Project</div>
    <button class="project-selector" type="button">
        <span class="project-dot"></span>
        @_projectName
    </button>
    <span class="project-path">@_projectPath</span>
</div>

<nav class="sidebar-nav">
    <div class="sidebar-label">Workspace</div>
    <NavLink class="sidebar-link" href="" Match="NavLinkMatch.All">
        <span class="nav-icon">@((MarkupString)Icons.Kanban)</span>
        Kanban Board
    </NavLink>
    <NavLink class="sidebar-link" href="agent-terminals">
        <span class="nav-icon">@((MarkupString)Icons.Terminal)</span>
        Agent Terminals
    </NavLink>
    <NavLink class="sidebar-link" href="insights">
        <span class="nav-icon">@((MarkupString)Icons.Insights)</span>
        Insights
    </NavLink>
    <NavLink class="sidebar-link" href="roadmap">
        <span class="nav-icon">@((MarkupString)Icons.Roadmap)</span>
        Roadmap
    </NavLink>
    <NavLink class="sidebar-link" href="ideation">
        <span class="nav-icon">@((MarkupString)Icons.Ideation)</span>
        Ideation
    </NavLink>
    <NavLink class="sidebar-link" href="changelog">
        <span class="nav-icon">@((MarkupString)Icons.Changelog)</span>
        Changelog
    </NavLink>
    <NavLink class="sidebar-link" href="context">
        <span class="nav-icon">@((MarkupString)Icons.Context)</span>
        Context
    </NavLink>

    <div class="sidebar-label">Tools</div>
    <NavLink class="sidebar-link" href="github-issues">
        <span class="nav-icon">@((MarkupString)Icons.GitHub)</span>
        GitHub Issues
    </NavLink>
    <NavLink class="sidebar-link" href="github-prs">
        <span class="nav-icon">@((MarkupString)Icons.PullRequest)</span>
        GitHub PRs
    </NavLink>
    <NavLink class="sidebar-link" href="gitlab-issues">
        <span class="nav-icon">@((MarkupString)Icons.GitLab)</span>
        GitLab Issues
    </NavLink>
    <NavLink class="sidebar-link" href="gitlab-merge-requests">
        <span class="nav-icon">@((MarkupString)Icons.MergeRequest)</span>
        GitLab MRs
    </NavLink>
    <NavLink class="sidebar-link" href="agent-tools">
        <span class="nav-icon">@((MarkupString)Icons.Tools)</span>
        Agent Tools
    </NavLink>
    <NavLink class="sidebar-link" href="worktrees">
        <span class="nav-icon">@((MarkupString)Icons.Worktrees)</span>
        Worktrees
    </NavLink>
</nav>

<div class="sidebar-footer">
    <NavLink class="ghost-button" href="settings">
        <span class="nav-icon">@((MarkupString)Icons.Settings)</span>
        Settings
    </NavLink>
    <button class="primary-button" type="button">
        <span class="nav-icon">@((MarkupString)Icons.Plus)</span>
        New Task
    </button>
</div>

@code {
    private string _projectName = "autonomous-coding";
    private string _projectPath = "/Users/yourname/projects/auto-corker";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var settings = await SettingsService.LoadAsync();
            if (!string.IsNullOrEmpty(settings.RepoPath))
            {
                _projectPath = settings.RepoPath;
                // Handle root path or empty path gracefully
                _projectName = System.IO.Path.GetFileName(_projectPath.TrimEnd(System.IO.Path.DirectorySeparatorChar));
                if (string.IsNullOrEmpty(_projectName))
                {
                    _projectName = _projectPath;
                }
            }
        }
        catch
        {
            // Fallback to default if loading fails
        }
    }

    private static class Icons
    {
        public const string Kanban = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M4 3a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h2V3H4zm6 0H8v14h2V3zm6 0h-2v14h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z'/></svg>";
        public const string Terminal = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M4 4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H4zm2.7 3.3a1 1 0 0 1 1.4 0l2 2a1 1 0 0 1 0 1.4l-2 2a1 1 0 0 1-1.4-1.4L8.6 10 6.7 8.1a1 1 0 0 1 0-1.4zM11 12a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2h-3z'/></svg>";
        public const string Insights = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M3 3a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V8.5a1 1 0 0 0-.3-.7l-3.5-3.5A1 1 0 0 0 13.5 4H3zm9 1.5L16.5 9H12V4.5zM6 12a1 1 0 1 1 2 0v2H6v-2zm4-3a1 1 0 1 1 2 0v5h-2V9zm4 2a1 1 0 1 1 2 0v3h-2v-3z'/></svg>";
        public const string Roadmap = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M4 3a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h4V3H4zm6 0h6a1 1 0 0 1 1 1v4h-7V3zm0 7h7v6a1 1 0 0 1-1 1h-6v-7z'/></svg>";
        public const string Ideation = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M10 2a6 6 0 0 0-3 11.2V16a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-2.8A6 6 0 0 0 10 2zm2 12H8v-1.1a5.9 5.9 0 0 0 4 0V14zm-4 2h4v1H8v-1z'/></svg>";
        public const string Changelog = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M4 3a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V8.5a1 1 0 0 0-.3-.7l-3.5-3.5A1 1 0 0 0 10.5 4H4zm8 1.5L16.5 9H12V4.5zM5 11a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2H6a1 1 0 0 1-1-1z'/></svg>";
        public const string Context = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M3 4a2 2 0 0 1 2-2h6.5a1 1 0 0 1 .7.3l3.5 3.5a1 1 0 0 1 .3.7V16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4zm9 0v3h3l-3-3zM6 11a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H7a1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2H7a1 1 0 0 1-1-1z'/></svg>";
        public const string GitHub = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M10 2a8 8 0 0 0-2.5 15.6c.4.1.5-.2.5-.4v-1.4c-2 .4-2.4-.9-2.4-.9-.4-1-.9-1.2-.9-1.2-.7-.5.1-.5.1-.5.8.1 1.2.8 1.2.8.7 1.2 1.9.9 2.4.7.1-.5.3-.9.5-1.1-1.6-.2-3.2-.8-3.2-3.6 0-.8.3-1.4.8-1.9-.1-.2-.3-.9.1-1.8 0 0 .6-.2 1.9.8a6.4 6.4 0 0 1 3.4 0c1.3-1 1.9-.8 1.9-.8.4.9.2 1.6.1 1.8.5.5.8 1.1.8 1.9 0 2.8-1.6 3.4-3.2 3.6.3.2.6.7.6 1.5v2.2c0 .2.1.5.5.4A8 8 0 0 0 10 2z'/></svg>";
        public const string GitLab = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M10 2l2.2 6.8h4.8L13 18l-3-4-3 4-4-9.2h4.8L10 2z'/></svg>";
        public const string PullRequest = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M5 3a2 2 0 1 1 0 4v6a2 2 0 1 1-2 0V7a2 2 0 0 1 2-4zm10 10a2 2 0 1 1-2 0V7h-3a2 2 0 1 1 0-2h5v8z'/></svg>";
        public const string MergeRequest = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M5 3a2 2 0 1 1 0 4v8a2 2 0 1 1-2 0V7a2 2 0 0 1 2-4zm10 0a2 2 0 1 1 0 4v4a3 3 0 0 1-3 3H9a2 2 0 1 1 0-2h3a1 1 0 0 0 1-1V7a2 2 0 0 1 2-4z'/></svg>";
        public const string Tools = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M9 2a3 3 0 0 0-3 3v1H4a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2v1a3 3 0 0 0 6 0v-1h2a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-2V5a3 3 0 0 0-3-3zm-1 3a1 1 0 0 1 2 0v1H8V5zm0 8v-1h2v1a1 1 0 0 1-2 0z'/></svg>";
        public const string Worktrees = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M4 3a1 1 0 0 0-1 1v4h2V5h10v3h2V4a1 1 0 0 0-1-1H4zm-1 9v4a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-4h-2v3H5v-3H3zm4-6a1 1 0 0 0-1 1v6h2V8h2V6H7zm6 0v2h2v6h2V7a1 1 0 0 0-1-1h-3z'/></svg>";
        public const string Settings = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M9.8 2a1 1 0 0 1 .9.6l.6 1.4a6.7 6.7 0 0 1 1.4.6l1.4-.6a1 1 0 0 1 1.2.4l1.3 2.2a1 1 0 0 1-.3 1.3l-1.2.9c.1.5.1 1.1 0 1.6l1.2.9a1 1 0 0 1 .3 1.3l-1.3 2.2a1 1 0 0 1-1.2.4l-1.4-.6a6.7 6.7 0 0 1-1.4.6l-.6 1.4a1 1 0 0 1-.9.6H8.2a1 1 0 0 1-.9-.6l-.6-1.4a6.7 6.7 0 0 1-1.4-.6l-1.4.6a1 1 0 0 1-1.2-.4l-1.3-2.2a1 1 0 0 1 .3-1.3l1.2-.9a6.8 6.8 0 0 1 0-1.6l-1.2-.9a1 1 0 0 1-.3-1.3l1.3-2.2a1 1 0 0 1 1.2-.4l1.4.6c.4-.3.9-.5 1.4-.6l.6-1.4a1 1 0 0 1 .9-.6h1.6zm.2 6a3 3 0 1 0 0 6 3 3 0 0 0 0-6z'/></svg>";
        public const string Plus = "<svg viewBox='0 0 20 20' fill='currentColor'><path d='M10 3a1 1 0 0 1 1 1v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5H4a1 1 0 1 1 0-2h5V4a1 1 0 0 1 1-1z'/></svg>";
    }
}
