@page "/changelog"
@using Corker.Orchestrator.Models
@inject Corker.Orchestrator.Services.WorkspaceDashboardService DashboardService

<section class="page-header">
    <div>
        <span class="page-kicker">Workspace</span>
        <h1>Changelog</h1>
        <p class="page-subtitle">Latest releases and UI updates for Corker.</p>
    </div>
    <div class="page-actions">
        <button class="ghost-button" type="button" @onclick="ViewAllAsync">View all</button>
        <button class="primary-button" type="button" @onclick="SubscribeAsync">@_subscribeLabel</button>
    </div>
</section>

<section class="page-content">
    <div class="timeline">
        @foreach (var entry in _entries)
        {
            <div class="timeline-item">
                <div class="timeline-marker"></div>
                <div>
                    <h3>@entry.Version</h3>
                    <p>@entry.Summary</p>
                </div>
                <span class="pill @entry.StatusClass">@entry.Status</span>
            </div>
        }
    </div>
</section>

@code {
    private IReadOnlyList<ChangelogEntry> _entries = Array.Empty<ChangelogEntry>();
    private string _subscribeLabel = "Subscribe";

    protected override async Task OnInitializedAsync()
    {
        _entries = await DashboardService.GetChangelogAsync();
    }

    private async Task ViewAllAsync()
    {
        _entries = await DashboardService.LoadFullChangelogAsync();
    }

    private async Task SubscribeAsync()
    {
        var subscribed = await DashboardService.SubscribeToChangelogAsync();
        _subscribeLabel = subscribed ? "Subscribed" : "Subscribe";
        _entries = await DashboardService.GetChangelogAsync();
    }
}
