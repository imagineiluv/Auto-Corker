@page "/agent-tools"
@using Corker.Orchestrator.Models
@inject Corker.Orchestrator.Services.WorkspaceDashboardService DashboardService
@inject NavigationManager NavigationManager

<section class="page-header">
    <div>
        <span class="page-kicker">Tools</span>
        <h1>Agent Tools</h1>
        <p class="page-subtitle">Manage automations available to your local-first agents.</p>
    </div>
    <div class="page-actions">
        <button class="ghost-button" type="button" @onclick="OpenManageSettings">Manage</button>
        <button class="primary-button" type="button" @onclick="ReloadAsync">Refresh</button>
    </div>
</section>

<section class="page-content">
    <div class="card-grid">
        @foreach (var tool in _tools)
        {
            <article class="info-card">
                <header>
                    <h3>@tool.Name</h3>
                    <span class="pill @tool.StatusClass">@tool.Status</span>
                </header>
                <p>@tool.Summary</p>
                <div class="panel-actions">
                    <button class="ghost-button" type="button" @onclick="() => ShowDetailsAsync(tool)">Details</button>
                    <button class="primary-button" type="button" @onclick="() => RunToolAsync(tool)">@tool.ActionLabel</button>
                </div>
            </article>
        }
    </div>
</section>

@code {
    private IReadOnlyList<AgentToolItem> _tools = Array.Empty<AgentToolItem>();

    protected override async Task OnInitializedAsync()
    {
        _tools = await DashboardService.GetAgentToolsAsync();
    }

    private async Task ReloadAsync()
    {
        _tools = await DashboardService.GetAgentToolsAsync();
    }

    private void OpenManageSettings()
    {
        NavigationManager.NavigateTo("/settings?tab=agents");
    }

    private async Task ShowDetailsAsync(AgentToolItem tool)
    {
        _tools = await DashboardService.ShowAgentToolDetailsAsync(tool.Name);
    }

    private async Task RunToolAsync(AgentToolItem tool)
    {
        _tools = await DashboardService.RunAgentToolAsync(tool.Name);
    }
}
